# 記事5: 物件公開ページのパスワード保護・有効期限機能
blog_post_5 = BlogPost.find_or_create_by!(public_id: 'publication-security-2025') do |post|
  post.title = "物件公開ページにパスワード保護と有効期限機能を追加"
  post.summary = "特定のお客様だけに物件情報を公開したい、期間限定で公開したい——そんなニーズに応える機能を実装しました。"
  post.content = <<~'MARKDOWN'
## 公開範囲をコントロールしたい

物件公開ページは便利ですが、時には**公開範囲を制限**したいケースがあります。

- 「このお客様だけに見せたい」
- 「1週間だけ公開したい」
- 「成約したら自動で非公開にしたい」

今回追加した**パスワード保護**と**有効期限**機能で、これらのニーズに対応できるようになりました。

## パスワード保護機能

### 設定方法

物件公開ページエディタで「パスワード保護」にチェックを入れ、パスワードを設定するだけ。

```ruby
# モデルでのパスワード認証
class PropertyPublication < ApplicationRecord
  def password_protected?
    access_password.present?
  end

  def authenticate_password(input_password)
    return true unless password_protected?
    access_password == input_password
  end
end
```

### お客様側の体験

パスワード保護されたページにアクセスすると、パスワード入力画面が表示されます。

正しいパスワードを入力すると、物件情報が表示されます。

### 使用シーン

- **VIP顧客向けの先行公開**: 一般公開前に特定のお客様だけに見せたい
- **競合への情報漏洩防止**: URLが拡散しても、パスワードがなければ見られない
- **内部レビュー用**: 公開前の確認用として社内共有

## 有効期限機能

### 設定方法

「有効期限」に日時を設定すると、その日時を過ぎると自動的にアクセス不可になります。

```ruby
# 有効期限のチェック
class PropertyPublication < ApplicationRecord
  def expired?
    expires_at.present? && expires_at < Time.current
  end

  def accessible?
    published? && !expired?
  end
end
```

### 期限切れ時の表示

有効期限が過ぎたページにアクセスすると、「公開期間が終了しました」というメッセージが表示されます（HTTPステータス: 410 Gone）。

### 使用シーン

- **期間限定キャンペーン**: 「今週末だけ特別公開」
- **成約後の自動非公開**: 成約予定日に合わせて期限を設定
- **イベント連動**: 内覧会期間中のみ公開

## スケジュール公開との組み合わせ

「スケジュール公開」機能と組み合わせると、**公開開始と終了を自動化**できます。

```
例: 12/1 10:00 に公開 → 12/7 23:59 に非公開

scheduled_publish_at: 2025-12-01 10:00
expires_at: 2025-12-07 23:59
```

これで、一度設定すれば手動での操作は不要です。

## プレビュー機能

パスワード保護や有効期限が設定されていても、**ログインユーザーはプレビューモードで確認**できます。

```
/property/abc123?preview=true
```

公開前の確認や、期限切れ後の内容確認に便利です。

## セキュリティに関する注意

パスワード保護は「簡易的なアクセス制限」です。以下の点にご注意ください。

- URLとパスワードを知っている人はアクセス可能
- 高度なセキュリティが必要な場合は、別途対策が必要

機密性の高い情報には、適切なセキュリティ対策を併用してください。

## まとめ

パスワード保護と有効期限機能で、物件公開ページの**公開範囲を柔軟にコントロール**できるようになりました。

- **パスワード保護**: 特定のお客様だけに公開
- **有効期限**: 期間限定公開を自動化
- **プレビュー**: 設定後も内容を確認可能

ぜひ営業活動にお役立てください。
  MARKDOWN
  post.status = :published
  post.published_at = Time.zone.parse('2025-12-30 14:00:00')
  post.commit_hash = '7aef09e'
end

puts "✓ 記事作成: #{blog_post_5.title}"
