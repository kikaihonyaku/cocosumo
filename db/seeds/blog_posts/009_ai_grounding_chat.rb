# 記事9: AIを使った周辺施設チャット
blog_post_9 = BlogPost.find_or_create_by!(public_id: 'ai-grounding-chat-2025') do |post|
  post.title = "AIチャットで周辺施設を調べる機能をリリース"
  post.summary = "建物詳細画面からAIに質問するだけで、物件周辺のスーパー、学校、病院などの情報を調べられます。"
  post.content = <<~'MARKDOWN'
## お客様からの「周辺に何がありますか？」

物件案内で必ず聞かれる質問があります。

> 「この辺りにスーパーはありますか？」
> 「最寄りの小学校はどこですか？」
> 「病院は近くにありますか？」

従来は、Googleマップで調べたり、地域の知識を頼りに答えたりしていました。しかし、管轄外のエリアや、新しくオープンした施設は把握しきれないこともあります。

そこで、**AIチャット機能**を開発しました。

## どんな機能？

建物詳細画面の地図パネルに、**AIチャット**を統合しました。

質問を入力するだけで、AIが物件周辺の施設情報を調べて回答します。

### 使用例

```
Q: 近くにスーパーはありますか？

A: この物件の周辺には以下のスーパーがあります：

   1. **まいばすけっと 恵比寿駅前店** - 徒歩3分（約200m）
      営業時間: 7:00-24:00

   2. **成城石井 恵比寿ガーデンプレイス店** - 徒歩5分（約350m）
      営業時間: 10:00-22:00

   3. **ピーコックストア 恵比寿店** - 徒歩7分（約500m）
      営業時間: 9:00-21:00
```

### 住所クリックで地図表示

AIの回答に含まれる住所はクリック可能。クリックすると、地図上にマーカーが表示されます。

## 技術的な仕組み

### Vertex AI Grounding with Google Maps

この機能は、Google CloudのVertex AIと、**Grounding with Google Maps**を組み合わせて実現しています。

```ruby
# VertexAiGroundingService（簡略化）
class VertexAiGroundingService
  def query(prompt, context)
    # 物件住所をコンテキストとして設定
    system_prompt = <<~PROMPT
      あなたは不動産の周辺情報アシスタントです。
      対象物件の住所: #{context[:address]}

      ユーザーの質問に対して、周辺施設の情報を
      Google Mapsのデータを参照して回答してください。
    PROMPT

    client.predict(
      endpoint: vertex_endpoint,
      instances: [{
        prompt: prompt,
        systemInstruction: system_prompt,
        groundingConfig: { googleMapsGrounding: {} }
      }]
    )
  end
end
```

### 会話履歴の保持

マルチターン会話に対応しており、前の質問を踏まえた回答が可能です。

```
Q: 近くに小学校はありますか？
A: 渋谷区立恵比寿小学校が徒歩8分の場所にあります。

Q: そこの評判はどうですか？
A: 恵比寿小学校は、渋谷区内でも人気の高い学校です...
```

「そこ」が「恵比寿小学校」を指していることを理解して回答します。

## 活用シーン

### 内見前の事前調査

お客様を案内する前に、周辺施設を把握しておけます。

### 電話問い合わせへの即答

「この物件の周辺に○○はありますか？」という問い合わせに、その場で調べて回答。

### 物件紹介資料の作成

AIの回答を参考に、物件紹介資料に周辺情報を追加。

## 質問のコツ

より良い回答を得るためのコツをいくつかご紹介します。

1. **具体的に聞く**: 「近くに何がありますか？」より「徒歩5分以内のコンビニ」
2. **複数施設をまとめて聞く**: 「スーパー、ドラッグストア、コンビニを教えて」
3. **条件を指定する**: 「24時間営業のスーパー」「小児科のある病院」

## 今後の展望

- 学区情報との連携
- 通勤時間シミュレーション
- ハザードマップ情報の統合

物件の「立地」をより深く理解できる機能へと進化させていきます。
  MARKDOWN
  post.status = :published
  post.published_at = Time.zone.parse('2025-12-05 10:00:00')
  post.commit_hash = '7f5c2e1'
end

puts "✓ 記事作成: #{blog_post_9.title}"
