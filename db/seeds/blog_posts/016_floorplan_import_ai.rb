# 記事16: 募集図面の取り込み機能
blog_post_16 = BlogPost.find_or_create_by!(public_id: 'floorplan-import-ai-2026') do |post|
  post.title = "AIで募集図面をデータ化！紙の情報資産をデジタルで活用"
  post.summary = "賃貸業界で長年活用されてきた募集図面（マイソク）をPDFでアップロードし、AIが自動で情報を抽出。物件管理システムへの一元化を実現します。"
  post.content = <<~'MARKDOWN'
## 募集図面という「優れた情報共有ツール」

賃貸不動産業界で働く方なら、**募集図面**（マイソク）を目にしたことがない人はいないでしょう。

A4やB4サイズの紙1枚に、物件の写真、間取り図、賃料条件、設備情報、周辺環境——あらゆる情報がコンパクトにまとめられています。

この募集図面、実は**情報共有ツールとして非常に優れている**のです。

- **一覧性が高い**: 1枚で物件の全体像がわかる
- **持ち運びやすい**: 印刷してお客様に渡せる
- **歴史がある**: 業界標準として定着している

FAXやメールで送れば、相手もすぐに物件の概要を把握できます。

## しかし、デジタル化の壁があった

一方で、募集図面には大きな課題がありました。

> **「データとして扱えない」**

各不動産会社が**オリジナルのフォーマット**で作成しているため、募集図面の情報を自動的にデータ化することが困難だったのです。

```
A社の募集図面: 賃料が左上に記載
B社の募集図面: 賃料が右上に記載
C社の募集図面: 賃料が中央に大きく記載
```

フォーマットがバラバラなので、OCRで単純に読み取ることもできません。

結果として、募集図面の情報を物件管理システムに登録するには**手入力**が必要でした。

- 募集図面を見ながら、賃料を入力
- 間取りを入力
- 設備を一つずつ入力
- ...

これは時間がかかるだけでなく、**入力ミス**のリスクもあります。

## AIで解決：募集図面の自動データ化

CoCoスモは、この課題を**AI（Google Gemini）**の力で解決しました。

### 仕組み

```
募集図面（PDF）
    ↓ アップロード
CoCoスモ
    ↓ Gemini API
AI解析
    ↓ JSON形式で抽出
部屋情報として登録
```

フォーマットがバラバラでも、AIが**文脈を理解**して情報を抽出します。

### 抽出できる情報

| カテゴリ | 抽出項目 |
|----------|----------|
| 基本情報 | 間取り、専有面積 |
| 賃料条件 | 賃料、管理費・共益費、敷金、礼金 |
| 物件詳細 | 向き、階数、入居可能日 |
| 設備 | エアコン、バス・トイレ別、オートロック等 |
| 付帯条件 | 駐車場料金、ペット可否、保証人要否、二人入居可 |
| その他 | 物件説明・アピールポイント |

15項目以上の情報を、ワンクリックで抽出できます。

## 使い方

### Step 1: 募集図面PDFをアップロード

部屋詳細画面の「募集図面」セクションに、PDFファイルをドラッグ&ドロップ。

```jsx
// ドラッグ&ドロップでアップロード
<Box
  onDragOver={handleDragOver}
  onDrop={handleDrop}
>
  募集図面（PDF）をドラッグ&ドロップ
</Box>
```

アップロードすると、PDFの1ページ目が**サムネイル画像**として表示されます。クリックするとPDF全体を確認できます。

### Step 2: AI解析を実行

「AI解析」ボタンをクリックすると、Gemini AIが募集図面を読み取り、情報を抽出します。

```ruby
# バックエンドでの処理（簡略化）
def analyze_floorplan
  pdf_data = @room.floorplan_pdf.download
  pdf_base64 = Base64.strict_encode64(pdf_data)

  client = Gemini.new(
    credentials: { api_key: ENV['GEMINI_API_KEY'] },
    options: { model: 'gemini-2.5-flash' }
  )

  result = client.generate_content({
    contents: {
      parts: [
        { text: extraction_prompt },
        { inline_data: { mime_type: 'application/pdf', data: pdf_base64 } }
      ]
    }
  })

  # AIの回答をJSONとしてパース
  JSON.parse(result.dig('candidates', 0, 'content', 'parts', 0, 'text'))
end
```

### Step 3: 適用する項目を選択

解析結果がダイアログで表示されます。

```
┌─────────────────────────────────────────┐
│  募集図面 AI解析結果                      │
├─────────────────────────────────────────┤
│  ☑ 間取り        1LDK                   │
│  ☑ 専有面積      45.5 ㎡                │
│  ☑ 賃料          85,000 円              │
│  ☑ 管理費        5,000 円               │
│  ☑ 敷金          85,000 円（1ヶ月）      │
│  ☑ 礼金          85,000 円（1ヶ月）      │
│  ☑ 向き          南                     │
│  ☑ 階数          3 階                   │
│  ☑ 設備          エアコン, バス・トイレ別 │
│  ☐ 駐車場料金    なし                   │
│  ...                                    │
├─────────────────────────────────────────┤
│            [キャンセル] [選択した項目を適用] │
└─────────────────────────────────────────┘
```

チェックボックスで**適用したい項目だけを選択**できます。

- 「全選択」「全解除」ボタンで一括操作
- 既存データと異なる項目だけ選択、など柔軟に対応

### Step 4: 部屋情報に一括登録

「選択した項目を適用」ボタンを押すと、選択した情報が部屋データに自動登録されます。

```javascript
// 選択した項目を部屋情報に適用
const handleApplyData = () => {
  const dataToApply = {};
  Object.keys(selectedFields).forEach(key => {
    if (selectedFields[key] && extractedData[key] !== null) {
      dataToApply[key] = extractedData[key];
    }
  });
  onRoomDataExtracted(dataToApply);
};
```

手入力なしで、部屋情報の登録が完了します。

## 技術的なポイント

### フォーマット非依存のAI抽出

従来のOCRやルールベースの抽出では、フォーマットごとにルールを定義する必要がありました。

```
// 従来のアプローチ（フォーマット依存）
if (format === 'A社') {
  rent = extractFromPosition(10, 50);
} else if (format === 'B社') {
  rent = extractFromPosition(200, 30);
}
// ... フォーマットが増えるたびにルール追加
```

Gemini AIは**文脈を理解**するため、フォーマットに関係なく「賃料」という概念を認識して抽出できます。

```ruby
# AIへのプロンプト（一部）
prompt = <<~PROMPT
  このPDFは賃貸物件の募集図面です。
  以下の情報を抽出してJSON形式で出力してください。

  - rent: 賃料（数値のみ、円）
  - management_fee: 管理費・共益費
  - deposit: 敷金
  ...
PROMPT
```

### 敷金・礼金の「○ヶ月」表記への対応

募集図面では、敷金・礼金が「1ヶ月」「2ヶ月」と月数で表記されることが多いです。

AIはこれを認識し、賃料から金額を自動計算します。

```ruby
# 月数から金額を計算
if extracted_data['rent'] && extracted_data['deposit_months']
  extracted_data['deposit'] =
    extracted_data['rent'] * extracted_data['deposit_months']
end
```

### PDFサムネイルの自動生成

アップロードされたPDFの1ページ目を、MiniMagickで画像に変換してサムネイル表示しています。

```ruby
# PDFから画像を生成
def generate_thumbnail(pdf_blob)
  pdf_blob.open do |file|
    image = MiniMagick::Image.new(file.path + '[0]') # 1ページ目
    image.format('png')
    image.resize('400x400>')
    # Active Storageに保存
  end
end
```

これにより、一覧画面でも募集図面の内容がひと目でわかります。

## 募集図面 + 物件管理システム = 最強の組み合わせ

募集図面の良さは**一覧性**。物件管理システムの良さは**検索性・データ活用**。

CoCoスモは、この2つを組み合わせます。

### 募集図面の一覧性を活かす

- サムネイル表示で、募集図面の内容をすぐに確認
- PDFをそのまま保存し、いつでも印刷・送付可能
- 物件詳細画面で、データと募集図面を並べて表示

### 物件管理システムのデータ活用

- AIで抽出したデータで、条件検索が可能に
- 複数物件の賃料比較、統計分析
- お客様への提案資料に自動反映

**「紙の良さ」と「デジタルの良さ」を両立**する——これがCoCoスモの募集図面機能です。

## 活用シーン

### 他社から受け取った募集図面の登録

管理会社から届いた募集図面を、AI解析でサクッと登録。手入力の手間を大幅削減。

### 既存物件のデータ整備

「募集図面はあるけど、システムには未登録」という物件を、まとめてデータ化。

### 物件情報の更新確認

募集図面が更新されたとき、AI解析で変更点を確認。賃料変更などを見落としません。

## 今後の展望

### 複数ページ対応

現在は1ページ目のみ解析対象ですが、複数ページの募集図面にも対応予定。

### 画像ファイル対応

PDF以外にも、JPEGやPNGで撮影・スキャンした募集図面も解析できるように。

### 一括アップロード

複数の募集図面をまとめてアップロードし、一括でAI解析する機能。

## まとめ

募集図面は、賃貸不動産業界で長年愛用されてきた**優れた情報共有ツール**です。

しかし、フォーマットのバラつきから**デジタル化の壁**がありました。

CoCoスモは、**AIの力**でこの壁を突破します。

- 募集図面をPDFでアップロード
- AIが15項目以上の情報を自動抽出
- チェックボックスで選択して一括登録
- サムネイル表示で一覧性も確保

**紙の資産をデジタルで活用**——ぜひお試しください。
  MARKDOWN
  post.status = :published
  post.published_at = Time.zone.parse('2026-01-03 10:00:00')
  post.commit_hash = '38551ce'
end

puts "✓ 記事作成: #{blog_post_16.title}"
