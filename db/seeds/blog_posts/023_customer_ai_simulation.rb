# 記事23: 顧客向けAI画像シミュレーション機能
blog_post_23 = BlogPost.find_or_create_by!(public_id: 'customer-ai-simulation-2026') do |post|
  post.title = "お客様自身で物件をイメージできる「AI画像シミュレーション」"
  post.summary = "顧客向け物件ページにAI画像編集機能を追加。夜景、家具配置、季節の変化など、お客様自身がワンクリックでシミュレーションできるようになりました。"
  post.content = <<~'MARKDOWN'
物件を検討中のお客様から、こんな質問をいただくことがあります。

> 「この部屋、家具を置いたらどんな感じになりますか？」

> 「夜の外観ってどんな雰囲気ですか？」

> 「カーテンをつけたらどう見えますか？」

営業担当者がその都度、画像を加工して送る…という対応では、時間がかかりすぎます。そこで今回、**お客様自身がAIを使って物件画像をシミュレーションできる機能**を追加しました。

## 機能の概要

顧客向け物件ページ（顧客アクセス権で閲覧するページ）に「AIシミュレーション」セクションを追加しました。

お客様は以下の流れでシミュレーションを実行できます：

1. 物件写真を選択
2. シミュレーション内容を選ぶ
3. 「シミュレーション実行」をクリック
4. 数秒で結果画像が表示される

**1日10回まで**の利用制限を設けており、API費用の管理と乱用防止を両立しています。

## 選べるプリセット

よく使われるシミュレーションをワンクリックで実行できるプリセットを用意しました。

### 時間帯の変化

| プリセット | 内容 |
|-----------|------|
| 夜の外観 | 空を夕暮れ〜夜に変更し、窓から室内照明が漏れる様子を追加 |

外観写真は昼間に撮影することが多いですが、夜の雰囲気を気にされるお客様も多いです。

### 季節の変化

| プリセット | 内容 |
|-----------|------|
| 春の風景 | 樹木や植栽を桜や春の花に変更 |

冬に撮影した外観写真でも、春の華やかな雰囲気をイメージできます。

### インテリア

| プリセット | 内容 |
|-----------|------|
| カーテン（白） | 窓に白いレースカーテンを追加 |
| モダン家具 | シンプルなソファとローテーブルを配置 |
| ナチュラル家具 | 木製のダイニングテーブルと椅子を配置 |

空室の写真に家具を追加することで、実際の生活をイメージしやすくなります。

### その他

| プリセット | 内容 |
|-----------|------|
| 空室クリーン | 床や壁の汚れを除去し、清掃後の状態に |

撮影時に多少の汚れがあっても、クリーンな状態をシミュレーションできます。

## カスタムプロンプトにも対応

プリセット以外にも、お客様自身でプロンプト（指示文）を入力できます。

```
例: 窓にブラインドを追加して、午後の日差しが差し込む様子にしてください。
```

不動産物件に適した内容であれば、柔軟にシミュレーションが可能です。

## 技術的な実装

### Google Gemini API

画像生成にはGoogleの**Gemini 2.5 Flash Image**モデルを使用しています。

```ruby
GEMINI_MODEL = 'gemini-2.5-flash-image'
```

高速かつ高品質な画像編集が可能で、数秒でシミュレーション結果が返ってきます。

### セッション単位の利用制限

利用回数はセッション単位（IPアドレス + 物件ページ）で管理しています。

```ruby
class CustomerImageSimulation < ApplicationRecord
  DAILY_LIMIT = 10

  def self.remaining_quota(property_publication_id, session_id)
    used_count = where(property_publication_id: property_publication_id)
                   .where(session_id: session_id)
                   .today
                   .count
    [DAILY_LIMIT - used_count, 0].max
  end
end
```

ログイン不要のため、お客様が気軽に試せる一方、1日10回の制限でAPI費用をコントロールしています。

### プロンプトの最適化

お客様が選んだプリセットに対して、AI向けに最適化されたプロンプトを送信しています。

```ruby
def build_customer_prompt(user_prompt)
  base_instruction = "以下の指示に従って画像を編集してください。元の画像の構造や重要な要素は保持し、指示された部分のみを自然に変更してください。"
  "#{base_instruction}\n\n#{user_prompt}"
end
```

「建物の形状は変更しない」「既存の要素は保持する」といった制約を加えることで、不自然な結果を防いでいます。

## 画面構成

### 写真選択

物件ページに掲載されている写真から、シミュレーション対象を選択します。

- 建物外観写真
- 室内写真

サムネイル一覧から選ぶだけの簡単操作です。

### プロンプト選択

カテゴリ別に整理されたChip UIで、直感的に選択できます。

```jsx
<Chip
  icon={<NightsStayIcon />}
  label="夜の外観"
  onClick={() => handlePresetSelect(preset)}
  color={isSelected ? 'primary' : 'default'}
/>
```

選択中のプロンプト内容も表示されるので、何が実行されるか確認できます。

### 残り回数表示

画面上部に「本日の残り回数」を常に表示。

```jsx
<SimulationQuotaIndicator
  remaining={remaining}
  total={10}
/>
```

残り0回になると、ボタンが無効化されてAPIコールを防止します。

### 結果表示

シミュレーション結果は即座に画面に表示されます。

- 元画像と結果画像を並べて比較
- 結果画像はダウンロード可能
- 履歴として当日分を保持

## 活用シーン

### お客様側

1. **内見前の事前確認** - 家具を置いたイメージで検討
2. **家族への共有** - シミュレーション結果をダウンロードして共有
3. **比較検討** - 複数パターンを試して理想を明確化

### 不動産会社側

1. **営業時間外の対応** - お客様自身で試せるので待たせない
2. **工数削減** - 画像加工の依頼対応が不要に
3. **成約率向上** - お客様の「イメージできない」を解消

## まとめ

**お客様が自分でイメージを膨らませる**。

これまで営業担当者が対応していた「〇〇したらどう見えますか？」という質問に、お客様自身がAIを使って答えを見つけられるようになりました。

- プリセットでワンクリックシミュレーション
- カスタムプロンプトで自由な指示も可能
- 1日10回の制限でコスト管理

お客様の物件検討をより楽しく、よりスムーズにする機能です。顧客アクセス権を発行する際は、ぜひこの機能もご案内ください。
  MARKDOWN
  post.status = :published
  post.published_at = Time.zone.parse('2026-01-16 12:00:00')
  post.commit_hash = 'd5b4aba'
end

puts "✓ 記事作成: #{blog_post_23.title}"
