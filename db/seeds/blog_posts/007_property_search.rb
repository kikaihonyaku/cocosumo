# 記事7: 物件管理の検索機能
blog_post_7 = BlogPost.find_or_create_by!(public_id: 'property-search-2025') do |post|
  post.title = "地図と連動した物件検索機能のご紹介"
  post.summary = "条件指定、地図上での範囲選択、レイヤー絞り込みなど、多彩な検索機能で物件を素早く見つけられます。"
  post.content = <<~'MARKDOWN'
## 物件を探す、という課題

不動産会社が管理する物件は、数十件から数千件まで様々です。その中から「条件に合う物件」を素早く見つけることは、日常業務の大きな課題です。

> 「駅から徒歩10分以内で、家賃8万円以下の1Kを探して」

こんなリクエストに、スムーズに応えられていますか？

CoCoスモの物件検索機能は、**条件指定**と**地図連動**を組み合わせて、直感的に物件を探せるように設計されています。

## 3つの検索アプローチ

### 1. 条件で絞り込む

左パネルの「検索」ボタンから、詳細な条件を指定できます。

- **賃料**: 最小〜最大の範囲指定（スライダー対応）
- **間取り**: 1R、1K、1DK、1LDK、2LDK...
- **面積**: 最小〜最大㎡
- **築年数**: 新築〜指定年数以内
- **ステータス**: 空室のみ、成約済みを含む、など

```javascript
// フィルター条件の例
const filters = {
  rent: { min: 50000, max: 80000 },
  roomType: ['1K', '1DK'],
  area: { min: 20 },
  yearBuilt: { max: 10 }
};
```

### 2. 地図上で範囲選択

「もっと視覚的に探したい」という方には、地図上での範囲選択がおすすめです。

#### 円で選択

指定した地点を中心に、半径○○mの範囲で物件を検索。

「この駅から徒歩圏内」という探し方に最適です。

#### ポリゴンで選択

自由な形で範囲を描いて検索。

「この学区内」「この川の南側」など、複雑な条件にも対応できます。

### 3. レイヤーで絞り込む

学区や行政区域などの**GeoJSONレイヤー**を表示し、クリックするだけで絞り込み。

```javascript
// レイヤークリック時の処理
const handleLayerClick = (feature) => {
  const geometry = feature.getGeometry();
  setGeoFilter({
    type: 'polygon',
    coordinates: geometry.getCoordinates()
  });
};
```

「○○小学校区内の物件」をワンクリックで抽出できます。

## リアルタイム集計

検索条件を変更すると、**リアルタイムで集計情報**が更新されます。

- 物件数: 123件
- 空室数: 45件
- 平均家賃: 72,500円
- 築年数分布: グラフ表示

条件を変えながら、市場の傾向を把握できます。

## 検索結果の活用

### 一覧表示

検索結果は一覧で表示され、クリックで詳細に移動。カラムでのソートも可能です。

### 地図表示

検索結果の物件が地図上にピン表示されます。クリックすると物件概要がポップアップ。

### CSV出力

検索結果をCSVでエクスポート。他のツールでの分析に活用できます。

## 検索条件の保存

よく使う検索条件は保存しておけます。

- 「徒歩10分以内・1K」
- 「ファミリー向け（2LDK以上）」
- 「○○学区内」

毎回同じ条件を入力する手間が省けます。

## まとめ

CoCoスモの物件検索は、**条件指定**、**地図範囲選択**、**レイヤー絞り込み**の3つのアプローチを組み合わせて使えます。

- 条件がはっきりしている → 検索フィルター
- エリアで探したい → 地図範囲選択
- 学区・行政区域で探したい → レイヤー絞り込み

お客様のニーズに合わせて、最適な方法で物件を探してください。
  MARKDOWN
  post.status = :published
  post.published_at = Time.zone.parse('2025-12-01 10:00:00')
  post.commit_hash = '89039af'
end

puts "✓ 記事作成: #{blog_post_7.title}"
